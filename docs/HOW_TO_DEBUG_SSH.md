# üîç –ö–∞–∫ –¥–µ–±–∞–∂–∏—Ç—å SSH –ø—Ä–æ–±–ª–µ–º—ã

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–æ–ª–Ω—ã–π –¥–µ–±–∞–≥ —Å–∫—Ä–∏–ø—Ç:

```bash
cd ~/dns_server
bash scripts/debug-ssh-full.sh
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø–æ–∫–∞–∂–µ—Ç **–í–°–Å** —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å SSH –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ.

---

## –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –¥–µ–±–∞–≥ —Å–∫—Ä–∏–ø—Ç?

–°–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç 8 —à–∞–≥–æ–≤ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:

### –®–ê–ì 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ VM
- ‚úì –°—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ VM
- ‚úì –ó–∞–ø—É—â–µ–Ω–∞ –ª–∏ VM
- ‚úì –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ VM (CPU, –ø–∞–º—è—Ç—å, –∏ —Ç.–¥.)

### –®–ê–ì 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–∏
- ‚úì Ping VM (–¥–æ—Å—Ç—É–ø–Ω–∞ –ª–∏ –≤ —Å–µ—Ç–∏)
- ‚úì –ü–æ—Ä—Ç 22 –æ—Ç–∫—Ä—ã—Ç (SSH —Å–ª—É—à–∞–µ—Ç)
- ‚úì SSH –±–∞–Ω–Ω–µ—Ä (—á—Ç–æ –æ—Ç–≤–µ—á–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä)

### –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ SSH –∫–ª—é—á–µ–π –ª–æ–∫–∞–ª—å–Ω–æ
- ‚úì –°—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á (~/.ssh/id_rsa)
- ‚úì –°—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á (~/.ssh/id_rsa.pub)
- ‚úì –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ª–∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ (600)

### –®–ê–ì 4: –î–µ—Ç–∞–ª—å–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- ‚úì SSH —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º verbose (-vvv)
- ‚úì –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞–∂–¥—ã–π —à–∞–≥ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- ‚úì –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –æ—à–∏–±–∫–∏

### –®–ê–ì 5: –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø–æ SSH –∫–ª—é—á—É
- ‚úì –ü—Ä–æ–±—É–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –ø–æ –∫–ª—é—á—É
- ‚úì –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ –∫–ª—é—á—É

### –®–ê–ì 6: –ü–æ–ª—É—á–µ–Ω–∏–µ SSH –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å VM
- ‚úì –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è SSH –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (sshd -T)
- ‚úì –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–æ–Ω—Ñ–∏–≥ —Ñ–∞–π–ª–æ–≤ –≤ /etc/ssh/sshd_config.d/
- ‚úì –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–∞–∂–¥–æ–≥–æ –∫–æ–Ω—Ñ–∏–≥ —Ñ–∞–π–ª–∞
- ‚úì –°—Ç–∞—Ç—É—Å SSH —Å–µ—Ä–≤–∏—Å–∞
- ‚úì –õ–æ–≥–∏ SSH (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 20 —Å—Ç—Ä–æ–∫)
- ‚úì –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ ubuntu
- ‚úì –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ª–∏ –ø–∞—Ä–æ–ª—å
- ‚úì SSH authorized_keys

### –®–ê–ì 7: –¢–µ—Å—Ç –ø–∞—Ä–æ–ª—å–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- ‚úì –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è –ª–∏ –ø–∞—Ä–æ–ª—å
- ‚úì –ü—Ä–æ–±—É–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –¢–û–õ–¨–ö–û –ø–æ –ø–∞—Ä–æ–ª—é
- ‚úì –ò—Å–ø–æ–ª—å–∑—É–µ—Ç expect –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞

### –®–ê–ì 8: –ò—Ç–æ–≥–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑
- ‚úì –¢–∞–±–ª–∏—Ü–∞ –≤—Å–µ—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
- ‚úì –î–∏–∞–≥–Ω–æ–∑ –ø—Ä–æ–±–ª–µ–º—ã
- ‚úì –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- ‚úì –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

---

## –ü—Ä–∏–º–µ—Ä—ã –≤—ã–≤–æ–¥–∞

### ‚úÖ –ö–æ–≥–¥–∞ –í–°–Å —Ä–∞–±–æ—Ç–∞–µ—Ç:

```
–ö–û–ú–ü–û–ù–ï–ù–¢                                –°–¢–ê–¢–£–°
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
VM –∑–∞–ø—É—â–µ–Ω–∞:                             ‚úì –î–ê
–°–µ—Ç—å –¥–æ—Å—Ç—É–ø–Ω–∞ (ping):                    ‚úì –î–ê
SSH –ø–æ—Ä—Ç –æ—Ç–∫—Ä—ã—Ç:                         ‚úì –î–ê
SSH –∫–ª—é—á –Ω–∞–π–¥–µ–Ω:                         ‚úì –î–ê
–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ –∫–ª—é—á—É:                 ‚úì –†–ê–ë–û–¢–ê–ï–¢
–ü–∞—Ä–æ–ª—å–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:                ‚úì –†–ê–ë–û–¢–ê–ï–¢
```

### ‚ùå –ö–æ–≥–¥–∞ –ø–∞—Ä–æ–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç:

```
–ö–û–ú–ü–û–ù–ï–ù–¢                                –°–¢–ê–¢–£–°
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
VM –∑–∞–ø—É—â–µ–Ω–∞:                             ‚úì –î–ê
–°–µ—Ç—å –¥–æ—Å—Ç—É–ø–Ω–∞ (ping):                    ‚úì –î–ê
SSH –ø–æ—Ä—Ç –æ—Ç–∫—Ä—ã—Ç:                         ‚úì –î–ê
SSH –∫–ª—é—á –Ω–∞–π–¥–µ–Ω:                         ‚úì –î–ê
–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ –∫–ª—é—á—É:                 ‚úì –†–ê–ë–û–¢–ê–ï–¢
–ü–∞—Ä–æ–ª—å–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:                ‚úó –ù–ï –†–ê–ë–û–¢–ê–ï–¢

–û–°–ù–û–í–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê: –ü–∞—Ä–æ–ª—å–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

–ß–¢–û –≠–¢–û –û–ó–ù–ê–ß–ê–ï–¢:
‚Ä¢ SSH —Å–µ—Ä–≤–µ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∏–Ω–∏–º–∞—Ç—å –¢–û–õ–¨–ö–û –ø—É–±–ª–∏—á–Ω—ã–µ –∫–ª—é—á–∏
‚Ä¢ –ü–∞—Ä–æ–ª–∏ –ù–ï –ó–ê–ü–†–ê–®–ò–í–ê–Æ–¢–°–Ø –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ
‚Ä¢ –í –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ SSH: PasswordAuthentication no
```

---

## –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: "Permission denied (publickey)"

**–ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç:**
- SSH —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –¢–û–õ–¨–ö–û –∫–ª—é—á–∏
- –ü–∞—Ä–æ–ª–∏ –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç—Å—è
- PasswordAuthentication = no

**–†–µ—à–µ–Ω–∏–µ:**
```bash
bash scripts/fix-existing-vm-ssh.sh
```

–ò–ª–∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å VM:
```bash
bash scripts/recreate-vm.sh
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: "Connection refused"

**–ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç:**
- SSH —Å–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω
- –ü–æ—Ä—Ç 22 –∑–∞–∫—Ä—ã—Ç

**–†–µ—à–µ–Ω–∏–µ:**
–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å:
```bash
sudo virsh console dns-server
# –õ–æ–≥–∏–Ω: ubuntu / ubuntu
sudo systemctl start ssh
sudo systemctl enable ssh
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 3: "Connection timed out"

**–ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç:**
- VM –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
- –°–µ—Ç–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
- VM –Ω–µ –∑–∞–ø—É—â–µ–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å VM
sudo virsh list --all

# –ó–∞–ø—É—Å—Ç–∏—Ç—å VM
sudo virsh start dns-server

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ç—å
sudo virsh net-list
sudo virsh domifaddr dns-server
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 4: "Host key verification failed"

**–ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç:**
- –ö–ª—é—á —Ö–æ—Å—Ç–∞ –∏–∑–º–µ–Ω–∏–ª—Å—è (VM –±—ã–ª–∞ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∞)
- SSH –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ—Ç –æ –≤–æ–∑–º–æ–∂–Ω–æ–π –∞—Ç–∞–∫–µ

**–†–µ—à–µ–Ω–∏–µ:**
```bash
ssh-keygen -R 192.168.200.100
```

---

## –†—É—á–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ SSH —Å–ª—É—à–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 22:

```bash
nc -zv 192.168.200.100 22
```

–û–∂–∏–¥–∞–µ—Ç—Å—è: `Connection to 192.168.200.100 22 port [tcp/ssh] succeeded!`

---

### –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π:

```bash
ssh -vvv ubuntu@192.168.200.100
```

–ò—Å–∫–∞—Ç—å –≤ –≤—ã–≤–æ–¥–µ:
- `debug1: Offering public key` - –ø—Ä–æ–±—É–µ—Ç –∫–ª—é—á
- `debug1: Authentications that can continue: publickey` - —Ç–æ–ª—å–∫–æ –∫–ª—é—á–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã
- `debug1: Authentications that can continue: publickey,password` - –ø–∞—Ä–æ–ª–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã

---

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–∞—Ä–æ–ª—å–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é:

```bash
ssh -o PreferredAuthentications=password -o PubkeyAuthentication=no ubuntu@192.168.200.100
```

–ï—Å–ª–∏ –ø—Ä–æ—Å–∏—Ç –ø–∞—Ä–æ–ª—å - –ø–∞—Ä–æ–ª—å–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç.
–ï—Å–ª–∏ `Permission denied (publickey)` - –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç.

---

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SSH –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –Ω–∞ VM:

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –ø–æ –∫–ª—é—á—É
ssh -i ~/.ssh/id_rsa ubuntu@192.168.200.100

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
sudo sshd -T | grep passwordauthentication

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: passwordauthentication yes
```

---

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ SSH:

```bash
ssh -i ~/.ssh/id_rsa ubuntu@192.168.200.100 'sudo journalctl -u ssh -n 50'
```

---

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

```bash
ssh -i ~/.ssh/id_rsa ubuntu@192.168.200.100 'ls -la /etc/ssh/sshd_config.d/'
```

–î–æ–ª–∂–µ–Ω –±—ã—Ç—å: `01-custom-auth.conf` (—Å PasswordAuthentication yes)
–ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å: `50-cloud-init.conf` (–æ–Ω –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)

---

## –ü–æ–Ω–∏–º–∞–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ SSH –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**–í–ê–ñ–ù–û:** SSH —á–∏—Ç–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥–∏ –≤ –∞–ª—Ñ–∞–≤–∏—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ, –∏ **–ü–ï–†–í–ê–Ø** –¥–∏—Ä–µ–∫—Ç–∏–≤–∞ –ø–æ–±–µ–∂–¥–∞–µ—Ç!

```
/etc/ssh/sshd_config.d/
‚îú‚îÄ‚îÄ 01-custom-auth.conf          ‚Üê –ß–∏—Ç–∞–µ—Ç—Å—è –ü–ï–†–í–´–ú (–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
‚îÇ   ‚îî‚îÄ‚îÄ PasswordAuthentication yes
‚îú‚îÄ‚îÄ 50-cloud-init.conf          ‚Üê –ß–∏—Ç–∞–µ—Ç—Å—è –í–¢–û–†–´–ú (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è)
‚îÇ   ‚îî‚îÄ‚îÄ PasswordAuthentication no
‚îî‚îÄ‚îÄ 99-other.conf               ‚Üê –ß–∏—Ç–∞–µ—Ç—Å—è –ü–û–°–õ–ï–î–ù–ò–ú (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è)
    ‚îî‚îÄ‚îÄ PasswordAuthentication yes
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** `PasswordAuthentication yes` (–∏–∑ 01-custom-auth.conf)

---

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è —Ä–∞–±–æ—Ç—ã –¥–µ–±–∞–≥ —Å–∫—Ä–∏–ø—Ç–∞

–°–∫—Ä–∏–ø—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ:
- ‚úì `ssh` - –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- ‚úì `nc` (netcat) - –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ—Ä—Ç–æ–≤
- ‚úì `ping` - –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–µ—Ç–∏
- ‚ö† `virsh` - –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è VM (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- ‚ö† `expect` - –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ—Å—Ç–∞ –ø–∞—Ä–æ–ª–µ–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ —á–µ–≥–æ-—Ç–æ –Ω–µ—Ç - —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–ø—É—Å—Ç–∏—Ç —ç—Ç–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏.

---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ expect (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

Ubuntu/Debian:
```bash
sudo apt-get install expect
```

---

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ VM:

```bash
# –ü–æ SSH –∫–ª—é—á—É
ssh -i ~/.ssh/id_rsa ubuntu@192.168.200.100

# –ü–æ –ø–∞—Ä–æ–ª—é (–µ—Å–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç)
ssh ubuntu@192.168.200.100

# –ß–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å
sudo virsh console dns-server
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ VM:

```bash
# –°–ø–∏—Å–æ–∫ VM
sudo virsh list --all

# –ó–∞–ø—É—Å—Ç–∏—Ç—å VM
sudo virsh start dns-server

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å VM
sudo virsh shutdown dns-server

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ VM
sudo virsh dominfo dns-server

# IP –∞–¥—Ä–µ—Å VM
sudo virsh domifaddr dns-server
```

### Terraform:

```bash
cd examples/local

# –°–æ–∑–¥–∞—Ç—å VM
terraform apply

# –£–¥–∞–ª–∏—Ç—å VM
terraform destroy

# –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å VM
terraform destroy -auto-approve && terraform apply -auto-approve
```

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã

### –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å VM —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π:
```bash
bash scripts/recreate-vm.sh
```

### –ò—Å–ø—Ä–∞–≤–∏—Ç—å SSH –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π VM (—Ç—Ä–µ–±—É–µ—Ç—Å—è SSH –∫–ª—é—á):
```bash
bash scripts/fix-existing-vm-ssh.sh
```

### –ò—Å–ø—Ä–∞–≤–∏—Ç—å SSH –≤—Ä—É—á–Ω—É—é –Ω–∞ VM:
```bash
ssh -i ~/.ssh/id_rsa ubuntu@192.168.200.100
sudo bash /path/to/fix-ssh-password-auth.sh
```

---

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **docs/SSH_PASSWORD_AUTH_FIX.md** - –î–µ—Ç–∞–ª—å–Ω–∞—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (English)
- **docs/RUSSIAN_SSH_FIX.md** - –ö—Ä–∞—Ç–∫–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è (–†—É—Å—Å–∫–∏–π)
- **docs/HOW_TO_DEBUG_SSH.md** - –≠—Ç–æ—Ç —Ñ–∞–π–ª (–≥–∞–π–¥ –ø–æ –¥–µ–±–∞–≥—É)

---

**–ê–≤—Ç–æ—Ä:** Senior DevOps Engineer
**–î–∞—Ç–∞:** 2025-11-21
