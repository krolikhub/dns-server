# SSH Key Mismatch - Ð”Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ° Ð¸ Ð ÐµÑˆÐµÐ½Ð¸Ðµ

## ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð°

ÐŸÐ¾ÑÐ»Ðµ Ð·Ð°Ð¿ÑƒÑÐºÐ° `bash scripts/debug-ssh-full.sh` Ð¾Ð±Ð½Ð°Ñ€ÑƒÐ¶ÐµÐ½Ð° Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð°:

```
ubuntu@192.168.200.100: Permission denied (publickey).
```

**ÐŸÑ€Ð¸Ñ‡Ð¸Ð½Ð°**: SSH ÐºÐ»ÑŽÑ‡ Ð½Ð° Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð¹ Ð¼Ð°ÑˆÐ¸Ð½Ðµ (`~/.ssh/id_rsa.pub`) Ð½Ðµ ÑÐ¾Ð²Ð¿Ð°Ð´Ð°ÐµÑ‚ Ñ ÐºÐ»ÑŽÑ‡Ð¾Ð¼ Ð² `authorized_keys` Ð½Ð° Ð²Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ð¹ Ð¼Ð°ÑˆÐ¸Ð½Ðµ.

## ÐÐ½Ð°Ð»Ð¸Ð·

Ð˜Ð· debug Ð²Ñ‹Ð²Ð¾Ð´Ð° Ð²Ð¸Ð´Ð½Ð¾, Ñ‡Ñ‚Ð¾ SSH ÐºÐ»Ð¸ÐµÐ½Ñ‚ Ð¿Ñ€ÐµÐ´Ð»Ð°Ð³Ð°ÐµÑ‚ 3 ÐºÐ»ÑŽÑ‡Ð°:
1. `/home/cogito/.ssh/id_ed25519` (ED25519 SHA256:ZO+YO83dhiyLBD7WCgSIS72lF447Z0ooGlUgVlNtCxg)
2. `/home/cogito/.ssh/id_rsa` (RSA SHA256:PILFSggaLUvOEbRhl/lHB6hlwq+JUJ8cm6NwgVGvxNA)
3. `krolik_hub@proton.me` (ED25519 SHA256:h3KrQXgiVgLsRw0KPY69vWAN3lD8YeChyUQHOFZxNoc)

**Ð’ÑÐµ Ñ‚Ñ€Ð¸ ÐºÐ»ÑŽÑ‡Ð° Ð¾Ñ‚ÐºÐ»Ð¾Ð½ÑÑŽÑ‚ÑÑ ÑÐµÑ€Ð²ÐµÑ€Ð¾Ð¼** - ÑÑ‚Ð¾ Ð¾Ð·Ð½Ð°Ñ‡Ð°ÐµÑ‚, Ñ‡Ñ‚Ð¾ Ð½Ð° VM Ð½Ð°Ñ…Ð¾Ð´Ð¸Ñ‚ÑÑ Ð´Ñ€ÑƒÐ³Ð¾Ð¹ ÐºÐ»ÑŽÑ‡.

### Ð’Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ñ‹Ðµ Ð¿Ñ€Ð¸Ñ‡Ð¸Ð½Ñ‹

1. VM Ð±Ñ‹Ð»Ð° ÑÐ¾Ð·Ð´Ð°Ð½Ð° Ñ Ð´Ñ€ÑƒÐ³Ð¸Ð¼ SSH ÐºÐ»ÑŽÑ‡Ð¾Ð¼ (Ð½Ðµ Ñ‚ÐµÐ¼, Ñ‡Ñ‚Ð¾ ÑÐµÐ¹Ñ‡Ð°Ñ Ð² `~/.ssh/id_rsa.pub`)
2. SSH ÐºÐ»ÑŽÑ‡ Ð±Ñ‹Ð» Ð¿ÐµÑ€ÐµÐ³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½ Ð¿Ð¾ÑÐ»Ðµ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ VM
3. ÐŸÑ€Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ð¸ VM Ñ‡ÐµÑ€ÐµÐ· Terraform Ð±Ñ‹Ð» Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½ Ð½ÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¹ ÐºÐ»ÑŽÑ‡
4. Cloud-init Ð½Ðµ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾ Ð´Ð¾Ð±Ð°Ð²Ð¸Ð» ÐºÐ»ÑŽÑ‡ Ð² `authorized_keys`

## Ð ÐµÑˆÐµÐ½Ð¸Ñ

### ðŸš€ ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ° Ð¸ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ (Ð Ð•ÐšÐžÐœÐ•ÐÐ”Ð£Ð•Ð¢Ð¡Ð¯)

Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ ÐºÐ¾Ð¼Ð¿Ð»ÐµÐºÑÐ½Ñ‹Ð¹ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ¸:

```bash
bash scripts/diagnose-and-fix-ssh.sh
```

Ð­Ñ‚Ð¾Ñ‚ ÑÐºÑ€Ð¸Ð¿Ñ‚:
1. âœ… ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ðµ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ SSH ÐºÐ»ÑŽÑ‡Ð°
2. âœ… ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ ÑÑ‚Ð°Ñ‚ÑƒÑ VM
3. âœ… ÐŸÑ€Ð¾Ñ‚ÐµÑÑ‚Ð¸Ñ€ÑƒÐµÑ‚ ÑÐµÑ‚ÐµÐ²Ð¾Ðµ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ
4. âœ… ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐµÑ‚ Ñ€Ð°Ð·Ð»Ð¸Ñ‡Ð½Ñ‹Ðµ Ð¼ÐµÑ‚Ð¾Ð´Ñ‹ Ð°ÑƒÑ‚ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ð¸ (ÐºÐ»ÑŽÑ‡, Ð¿Ð°Ñ€Ð¾Ð»ÑŒ)
5. âœ… ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð¸Ñ‚ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñƒ ÐµÑÐ»Ð¸ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾
6. âœ… ÐŸÑ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²Ð¸Ñ‚ Ð´ÐµÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ð¸ ÐµÑÐ»Ð¸ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ Ñ€ÑƒÑ‡Ð½Ð¾Ðµ Ð²Ð¼ÐµÑˆÐ°Ñ‚ÐµÐ»ÑŒÑÑ‚Ð²Ð¾

### Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 1: Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ ÐºÐ»ÑŽÑ‡ Ñ‡ÐµÑ€ÐµÐ· virsh console

**ÐšÐ¾Ð³Ð´Ð° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ**: Ð•ÑÐ»Ð¸ Ð¿Ð°Ñ€Ð¾Ð»ÑŒÐ½Ð°Ñ Ð°ÑƒÑ‚ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ Ð½Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚, Ð½Ð¾ Ñƒ Ð²Ð°Ñ ÐµÑÑ‚ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ðº Ñ…Ð¾ÑÑ‚Ñƒ Ñ libvirt.

```bash
bash scripts/fix-ssh-key-via-console.sh
```

Ð˜Ð»Ð¸ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ:

```bash
# 1. ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒÑÑ Ðº ÐºÐ¾Ð½ÑÐ¾Ð»Ð¸ VM
sudo virsh console dns-server

# 2. Ð’Ð¾Ð¹Ñ‚Ð¸ (Ð»Ð¾Ð³Ð¸Ð½: ubuntu, Ð¿Ð°Ñ€Ð¾Ð»ÑŒ: ubuntu)

# 3. Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ ÐºÐ»ÑŽÑ‡
mkdir -p ~/.ssh && chmod 700 ~/.ssh
echo "YOUR_SSH_PUBLIC_KEY" >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys

# 4. Ð’Ñ‹Ð¹Ñ‚Ð¸ Ð¸Ð· ÐºÐ¾Ð½ÑÐ¾Ð»Ð¸ (Ctrl+])

# 5. ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ
ssh ubuntu@192.168.200.100
```

### Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 2: Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ð°Ñ€Ð¾Ð»ÑŒÐ½ÑƒÑŽ Ð°ÑƒÑ‚ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸ÑŽ

**ÐšÐ¾Ð³Ð´Ð° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ**: Ð•ÑÐ»Ð¸ cloud-init Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¸Ð» Ð¿Ð°Ñ€Ð¾Ð»ÑŒÐ½ÑƒÑŽ Ð°ÑƒÑ‚ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸ÑŽ.

Ð¡Ð¾Ð³Ð»Ð°ÑÐ½Ð¾ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸ `cloud-init/user-data.yml`:
- `ssh_pwauth: true` - Ð¿Ð°Ñ€Ð¾Ð»ÑŒÐ½Ð°Ñ Ð°ÑƒÑ‚ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ð°
- `plain_text_passwd: ubuntu` - Ð¿Ð°Ñ€Ð¾Ð»ÑŒ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ

```bash
# ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒÑÑ Ñ Ð¿Ð°Ñ€Ð¾Ð»ÐµÐ¼
ssh ubuntu@192.168.200.100
# ÐŸÐ°Ñ€Ð¾Ð»ÑŒ: ubuntu
```

Ð•ÑÐ»Ð¸ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚, Ð´Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ ÑÐ²Ð¾Ð¹ SSH ÐºÐ»ÑŽÑ‡:

```bash
# ÐÐ° VM Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ:
mkdir -p ~/.ssh && chmod 700 ~/.ssh
echo "$(cat ~/.ssh/id_rsa.pub)" >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
```

### Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 3: Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ sshpass Ð´Ð»Ñ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ð·Ð°Ñ†Ð¸Ð¸

**Ð¢Ñ€ÐµÐ±Ð¾Ð²Ð°Ð½Ð¸Ðµ**: ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ `sshpass`

```bash
sudo apt-get install sshpass
```

Ð—Ð°Ñ‚ÐµÐ¼ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ:

```bash
bash scripts/diagnose-and-fix-ssh.sh
```

Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸:
1. ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑÑ Ð¿Ð¾ Ð¿Ð°Ñ€Ð¾Ð»ÑŽ
2. Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ Ð²Ð°Ñˆ Ñ‚ÐµÐºÑƒÑ‰Ð¸Ð¹ SSH ÐºÐ»ÑŽÑ‡
3. ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ Ñ‡Ñ‚Ð¾ ÐºÐ»ÑŽÑ‡ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚

### Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 4: ÐŸÐµÑ€ÐµÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ VM (Ñ€Ð°Ð´Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¼ÐµÑ‚Ð¾Ð´)

**ÐšÐ¾Ð³Ð´Ð° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ**: Ð•ÑÐ»Ð¸ Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð¿Ð¾Ð¼Ð¾Ð³Ð»Ð¾ Ð¸Ð»Ð¸ Ð½ÑƒÐ¶Ð½Ð° Ñ‡Ð¸ÑÑ‚Ð°Ñ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ°.

```bash
cd examples/local
bash ../../scripts/recreate-vm.sh
```

Ð­Ñ‚Ð¾:
1. Ð£Ð´Ð°Ð»Ð¸Ñ‚ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰ÑƒÑŽ VM
2. Ð¡Ð¾Ð·Ð´Ð°ÑÑ‚ Ð½Ð¾Ð²ÑƒÑŽ VM Ñ Ñ‚ÐµÐºÑƒÑ‰Ð¸Ð¼ SSH ÐºÐ»ÑŽÑ‡Ð¾Ð¼ Ð¸Ð· `~/.ssh/id_rsa.pub`
3. Ð—Ð°Ð¹Ð¼Ñ‘Ñ‚ ~1-2 Ð¼Ð¸Ð½ÑƒÑ‚Ñ‹

## ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ð¾ÑÐ»Ðµ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ

```bash
# Ð¢ÐµÑÑ‚ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ð¿Ð¾ ÐºÐ»ÑŽÑ‡Ñƒ
ssh -o BatchMode=yes ubuntu@192.168.200.100 "echo 'SSH works!'"

# ÐŸÐ¾Ð»Ð½Ñ‹Ð¹ debug
bash scripts/debug-ssh-full.sh
```

## ÐŸÑ€ÐµÐ´Ð¾Ñ‚Ð²Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹ Ð² Ð±ÑƒÐ´ÑƒÑ‰ÐµÐ¼

### 1. Ð£Ð±ÐµÐ´Ð¸Ñ‚ÐµÑÑŒ Ñ‡Ñ‚Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚Ðµ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¹ ÐºÐ»ÑŽÑ‡

ÐŸÑ€Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ð¸ VM Ñ‡ÐµÑ€ÐµÐ· Terraform, ÑƒÐºÐ°Ð¶Ð¸Ñ‚Ðµ Ð½ÑƒÐ¶Ð½Ñ‹Ð¹ ÐºÐ»ÑŽÑ‡ Ð² `examples/local/terraform.tfvars`:

```hcl
ssh_public_key_path = "~/.ssh/id_rsa.pub"

# Ð˜Ð»Ð¸ Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ:
ssh_public_key_content = "ssh-rsa AAAAB3NzaC1yc2E... your@email.com"
```

### 2. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÐºÐ»ÑŽÑ‡ Ð¿ÐµÑ€ÐµÐ´ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸ÐµÐ¼ VM

```bash
# ÐŸÐ¾ÑÐ¼Ð¾Ñ‚Ñ€Ð¸Ñ‚Ðµ ÐºÐ°ÐºÐ¾Ð¹ ÐºÐ»ÑŽÑ‡ Ð±ÑƒÐ´ÐµÑ‚ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½
cat ~/.ssh/id_rsa.pub

# Fingerprint Ñ‚ÐµÐºÑƒÑ‰ÐµÐ³Ð¾ ÐºÐ»ÑŽÑ‡Ð°
ssh-keygen -lf ~/.ssh/id_rsa.pub
```

### 3. ÐŸÐ¾ÑÐ»Ðµ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ VM ÑÑ€Ð°Ð·Ñƒ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ

```bash
ssh -v ubuntu@192.168.200.100
```

Ð•ÑÐ»Ð¸ Ð½Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ - Ð¸ÑÐ¿Ñ€Ð°Ð²ÑŒÑ‚Ðµ ÑÑ€Ð°Ð·Ñƒ, Ð¿Ð¾ÐºÐ° Ð½Ðµ Ð·Ð°Ð±Ñ‹Ð»Ð¸!

## Ð”ÐµÑ‚Ð°Ð»ÑŒÐ½Ð°Ñ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ðµ

### Ð§Ñ‚Ð¾ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ debug

Ð˜Ð· `ssh -vvv` Ð²Ñ‹Ð²Ð¾Ð´Ð°:

```
debug1: Offering public key: /home/cogito/.ssh/id_rsa RSA SHA256:PILFSggaLUvOEbRhl/lHB6hlwq+JUJ8cm6NwgVGvxNA agent
debug3: send packet: type 50
debug2: we sent a publickey packet, wait for reply
debug3: receive packet: type 51
debug1: Authentications that can continue: publickey
```

`type 51` = `SSH2_MSG_USERAUTH_FAILURE` - ÑÐµÑ€Ð²ÐµÑ€ Ð¾Ñ‚ÐºÐ»Ð¾Ð½Ð¸Ð» ÐºÐ»ÑŽÑ‡.

### Ð“Ð´Ðµ Ñ…Ñ€Ð°Ð½ÑÑ‚ÑÑ ÐºÐ»ÑŽÑ‡Ð¸

**ÐÐ° Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð¹ Ð¼Ð°ÑˆÐ¸Ð½Ðµ**:
- ÐŸÑ€Ð¸Ð²Ð°Ñ‚Ð½Ñ‹Ð¹: `~/.ssh/id_rsa` (Ð¿Ñ€Ð°Ð²Ð°: 600)
- ÐŸÑƒÐ±Ð»Ð¸Ñ‡Ð½Ñ‹Ð¹: `~/.ssh/id_rsa.pub` (Ð¿Ñ€Ð°Ð²Ð°: 644)

**ÐÐ° VM**:
- ÐÐ²Ñ‚Ð¾Ñ€Ð¸Ð·Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ ÐºÐ»ÑŽÑ‡Ð¸: `/home/ubuntu/.ssh/authorized_keys` (Ð¿Ñ€Ð°Ð²Ð°: 600)

### ÐšÐ°Ðº cloud-init Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐµÑ‚ ÐºÐ»ÑŽÑ‡Ð¸

Ð˜Ð· `cloud-init/user-data.yml`:

```yaml
users:
  - name: ubuntu
    ssh_authorized_keys:
      - ${ssh_public_key}
```

ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ `${ssh_public_key}` Ð¿Ð¾Ð´ÑÑ‚Ð°Ð²Ð»ÑÐµÑ‚ÑÑ Ð¸Ð· Terraform:

```hcl
ssh_public_key = file(pathexpand("~/.ssh/id_rsa.pub"))
```

## Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð´Ð»Ñ Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ¸

```bash
# ÐŸÐ¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ ÐºÐ°ÐºÐ¸Ðµ ÐºÐ»ÑŽÑ‡Ð¸ Ð¿Ñ€ÐµÐ´Ð»Ð°Ð³Ð°ÐµÑ‚ ÐºÐ»Ð¸ÐµÐ½Ñ‚
ssh -vvv ubuntu@192.168.200.100 2>&1 | grep "Offering public key"

# Fingerprint Ð²ÑÐµÑ… Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ñ… ÐºÐ»ÑŽÑ‡ÐµÐ¹
for key in ~/.ssh/id_*.pub; do
  echo "$key:"
  ssh-keygen -lf "$key"
done

# ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ñ‡Ñ‚Ð¾ Ð½Ð° VM (Ñ‡ÐµÑ€ÐµÐ· virsh console)
sudo virsh console dns-server
# Ð’Ð¾Ð¹Ñ‚Ð¸ Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ:
cat ~/.ssh/authorized_keys
ls -la ~/.ssh/

# ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ ÑÑ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½ÑƒÑŽ SSH ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÑŽ Ð½Ð° VM
sudo virsh console dns-server
# Ð’Ð¾Ð¹Ñ‚Ð¸ Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ:
sudo sshd -T | grep -E '(passwordauthentication|pubkeyauthentication)'
```

## Ð¡Ð²ÑÐ·Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ñ‹

- [SSH_PASSWORD_AUTH_FIX.md](SSH_PASSWORD_AUTH_FIX.md) - Ð˜ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ð°Ñ€Ð¾Ð»ÑŒÐ½Ð¾Ð¹ Ð°ÑƒÑ‚ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ð¸
- [SSH_PASSWORD_AUTH_FIX_RU.md](SSH_PASSWORD_AUTH_FIX_RU.md) - Ð ÑƒÑÑÐºÐ°Ñ Ð²ÐµÑ€ÑÐ¸Ñ
- [SSH_DEBUG.md](SSH_DEBUG.md) - ÐžÐ±Ñ‰Ð°Ñ Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ° SSH Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼

## ÐšÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ñ‹

Ð•ÑÐ»Ð¸ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð° Ð½Ðµ Ñ€ÐµÑˆÐµÐ½Ð°, ÑÐ¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ issue Ð² Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¸ Ñ Ð¿Ð¾Ð»Ð½Ñ‹Ð¼ Ð²Ñ‹Ð²Ð¾Ð´Ð¾Ð¼:

```bash
bash scripts/debug-ssh-full.sh > ssh-debug.log 2>&1
```

Ð˜ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶Ð¸Ñ‚Ðµ Ñ„Ð°Ð¹Ð» `ssh-debug.log`.
